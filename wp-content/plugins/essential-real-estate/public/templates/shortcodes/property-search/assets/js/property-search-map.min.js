var ERE_Property_Map_Search=ERE_Property_Map_Search||{};!function(O){"use strict";var T,I,z=ere_search_vars.ajax_url,t=ere_search_vars.price_is_slider,H=".ere-search-properties-map",B=[],q=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(q=!0),ERE_Property_Map_Search={init:function(){"1"==ere_search_vars.enable_filter_location&&(O(".ere-property-country-ajax",H).select2(),O(".ere-property-state-ajax",H).select2(),O(".ere-property-city-ajax",H).select2(),O(".ere-property-neighborhood-ajax",H).select2()),this.full_screen(),this.get_states_by_country(),O(".ere-property-country-ajax",H).on("change",function(){ERE_Property_Map_Search.get_states_by_country()}),this.get_cities_by_state(),O(".ere-property-state-ajax",H).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),O(".ere-property-city-ajax",H).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()}),O(".btn-status-filter",H).on("click",function(e){e.preventDefault();var t=O(this).data("value");O(this).parent().find("input").val(t),O(this).parent().find("button").removeClass("active"),O(this).addClass("active"),ERE_Property_Map_Search.change_price_on_status_change(t)}),O('select[name="status"]',H).on("change",function(e){e.preventDefault();var t=O(this).val();ERE_Property_Map_Search.change_price_on_status_change(t)}),this.execute_url_search(),O(".ere-sliderbar-filter.ere-sliderbar-price",H).on("register.again",function(){O(".ere-sliderbar-filter.ere-sliderbar-price",H).each(function(){var e=O(this);ERE_Property_Map_Search.set_slider_filter(e)})}),this.register_slider_filter(),this.set_slider_value(),O(".other-features-wrap .btn-other-features",H).on("click",function(e){e.preventDefault(),O(".other-features-list",H).slideToggle(),O(this).toggleClass("show"),1==O(this).hasClass("show")?(O('input[name="features-search"]',H).attr("value","1"),O(this).find("i").removeClass("fa-chevron-down"),O(this).find("i").addClass("fa-chevron-up")):(O('input[name="features-search"]',H).attr("value","0"),O(this).find("i").removeClass("fa-chevron-up"),O(this).find("i").addClass("fa-chevron-down")),ERE_Property_Map_Search.search_on_change()}),O(".ere-sliderbar-filter.ere-sliderbar-price",H).on("register.again",function(){O(".ere-sliderbar-filter.ere-sliderbar-price",H).each(function(){var e=O(this);ERE_Property_Map_Search.set_slider_filter(e)})}),O(".ere-search-status-tab .btn-status-filter",H).on("click",function(){O(this).parent().find("input").val(O(this).data("value")),O(this).parent().find("button").removeClass("active"),O(this).addClass("active")}),O('select[name="type"], select[name="bedrooms"],select[name="bathrooms"] , select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',H).on("change",function(){ERE_Property_Map_Search.search_on_change()}),O('input[name="other_features"]',H).on("change",function(){ERE_Property_Map_Search.search_on_change()}),ERE_Property_Map_Search.search_properties("map_only")},get_states_by_country:function(){var e=O(".ere-property-country-ajax",H);if(e.length){var t=e.val();O.ajax({type:"POST",url:z,data:{action:"ere_get_states_by_country_ajax",country:t,type:1,is_slug:"1"},success:function(e){O(".ere-property-state-ajax",H).html(e);var t=O(".ere-property-state-ajax",H).attr("data-selected");void 0!==t&&O(".ere-property-state-ajax",H).val(t)}})}},get_cities_by_state:function(){var e=O(".ere-property-state-ajax",H);if(e.length){var t=e.val();O.ajax({type:"POST",url:z,data:{action:"ere_get_cities_by_state_ajax",state:t,type:1},success:function(e){O(".ere-property-city-ajax",H).html(e);var t=O(".ere-property-city-ajax",H).attr("data-selected");void 0!==t&&O(".ere-property-city-ajax",H).val(t)}})}},get_neighborhoods_by_city:function(){var e=O(".ere-property-city-ajax",H);if(e.length){var t=e.val();O.ajax({type:"POST",url:z,data:{action:"ere_get_neighborhoods_by_city_ajax",city:t,type:1,is_slug:"1"},success:function(e){O(".ere-property-neighborhood-ajax",H).html(e);var t=O(".ere-property-neighborhood-ajax",H).attr("data-selected");void 0!==t&&O(".ere-property-neighborhood-ajax",H).val(t)}})}},execute_url_search:function(){O(".ere-advanced-search-btn",H).on("click",function(e){e.preventDefault();var t=O(this).closest(".search-properties-form"),a=t.data("href"),o=[],r="?";-1!==a.indexOf("?")&&(r="&"),O(".search-field",t).each(function(){var e=O(this),t=e.attr("name"),a=e.val();a!=e.data("default-value")&&(o[t]=a)}),O(".ere-sliderbar-filter",t).each(function(){var e=O(this),t=e.find(".min-input-request").attr("name"),a=e.find(".max-input-request").attr("name"),r=e.find(".min-input-request").val(),i=e.find(".max-input-request").val(),n=e.data("min-default"),s=e.data("max-default");r==n&&i==s||(o[t]=r,o[a]=i)});var i="";if(O('[name="other_features"]',t).each(function(){var e=O(this),t=e.attr("value");e.is(":checked")&&(i+=t+";")}),""!==i&&(i=i.substring("0",i.length-1),o.other_features=i),o!==[])for(var n in o)o.hasOwnProperty(n)&&(r+=n+"="+o[n]+"&");r=r.substring("0",r.length-1),window.location.href=a+r})},set_slider_filter:function(e){var a,r,i=e,t=parseInt(i.attr("data-min-default")),n=parseInt(i.attr("data-max-default")),s=i.attr("data-min"),o=i.attr("data-max");i.find(".sidebar-filter").slider({min:t,max:n,range:!0,values:[s,o],slide:function(e,t){a=t.values[0],r=t.values[1],i.attr("data-min",a),i.attr("data-max",r),i.find("input.min-input-request").attr("value",a),i.find("input.max-input-request").attr("value",r),i.find("span").hasClass("not-format")?(i.find("span.min-value").html(a),i.find("span.max-value").html(r)):(i.find("span.min-value:not(.not-format)").html(ERE.number_format(a)),i.find("span.max-value:not(.not-format)").html(ERE.number_format(r)))},stop:function(e,t){ERE_Property_Map_Search.search_on_change()}})},register_slider_filter:function(){O(".ere-sliderbar-filter",H).each(function(){var e=O(this);ERE_Property_Map_Search.set_slider_filter(e)})},set_slider_value:function(){O(".ere-sliderbar-filter",H).each(function(){var e=O(this),t=e.attr("data-min-default"),a=e.attr("data-max-default"),r=e.attr("data-min"),i=e.attr("data-max"),n=(r-t)/(a-t)*100+"%",s=(i-r)/(a-t)*100+"%",o=(i-t)/(a-t)*100+"%";e.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:n,width:s}),e.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",n),e.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",o)})},change_price_on_status_change:function(e){O.ajax({type:"POST",url:z,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:e,price_is_slider:t},success:function(e){e.slide_html?(O(".ere-sliderbar-price-wrap",H).html(e.slide_html),ERE_Property_Map_Search.register_slider_filter(),ERE_Property_Map_Search.set_slider_value()):(e.min_price_html&&O('select[name="min-price"]',H).html(e.min_price_html),e.max_price_html&&O('select[name="max-price"]',H).html(e.max_price_html)),ERE_Property_Map_Search.search_on_change()}})},full_screen:function(){if(0<O(".ere-search-properties-map.style-vertical").length){var e=O(window).outerHeight(),t=O("#wpadminbar").outerHeight();null==t&&(t=0);var a=e-t-O("header").outerHeight()-O("footer").outerHeight()-O(".wpadminbar").outerHeight();O(".ere-search-properties-map.style-vertical .ere-map-search").css("height",a),O(".ere-search-properties-map.style-vertical .ere-map-search .ere-map-result").css("height",a),O(".col-scroll-vertical").css({height:a,"overflow-y":"scroll","overflow-x":"hidden"});var r=O(".owl-carousel",".list-property-result-ajax"),i=O(".property-item",r);r.trigger("destroy.owl.carousel"),r.css("opacity",1),r.imagesLoaded(function(){ERE.set_item_effect(i,"hide"),ERE_Carousel.owlCarousel(),i=O(".property-item",r),ERE.set_item_effect(i,"show")})}},search_on_change:function(){var e="map_only";0<O(".list-property-result-ajax",H).length&&(e="map_and_content"),ERE_Property_Map_Search.search_properties(e)},search_properties:function(c){var e,t,a,r,i,n,s,o,l,p,d,u,_,h,m,f,g,v,y,b,x=O(H);i=x.find('input[name="title"]').val(),h=x.find('input[name="address"]').val(),t=x.find('select[name="city"]').val(),s=x.find('select[name="type"]').val(),null==(n=x.find('select[name="status"]').val())&&(n=x.find('input[name="status"]').val()),o=x.find('select[name="bedrooms"]').val(),l=x.find('select[name="bathrooms"]').val(),d=O(".ere-sliderbar-price",x).length?(p=x.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min"),x.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")):(p=x.find('select[name="min-price"]').val(),x.find('select[name="max-price"]').val()),_=O(".ere-sliderbar-area",x).length?(u=x.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min"),x.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")):(u=x.find('select[name="min-area"]').val(),x.find('select[name="max-area"]').val()),y=O(".ere-sliderbar-land-area",x).length?(v=x.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min"),x.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")):(v=x.find('select[name="min-land-area"]').val(),x.find('select[name="max-land-area"]').val()),a=x.find('select[name="state"]').val(),e=x.find('select[name="country"]').val(),r=x.find('select[name="neighborhood"]').val(),g=x.find('select[name="label"]').val(),m=x.find('select[name="garage"]').val(),b=x.find('input[name="property_identity"]').val(),"1"==x.find('input[name="features-search"]').val()&&(f="",x.find(".other-features-list input[type=checkbox]:checked").each(function(){f+=O(this).val()+";"}),""!=f&&(f=f.substring(0,f.length-1)));var E=O("#ere_security_search_map").val(),w=O(x).find(".ere-map-result").attr("id"),P=O("#"+w),R=ere_search_vars.googlemap_default_zoom,j=ere_search_vars.not_found,M=ere_search_vars.clusterIcon,S=ere_search_vars.google_map_style,C=ere_search_vars.pin_cluster_enable,L={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scroll:{x:O(window).scrollLeft(),y:O(window).scrollTop()},zoom:parseInt(R),mapTypeId:google.maps.MapTypeId.ROADMAP,gestureHandling:"cooperative",fullscreenControl:!0,fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}};I=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1});function k(e,h){O.each(e,function(e,t){for(var a=new google.maps.LatLng(t.lat,t.lng),r={url:t.marker_icon,size:new google.maps.Size(44,60),scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)},i=a,n=0;n<B.length;n++){var s=B[n].getPosition();if(a.equals(s)){var o=a.lat()+(Math.random()-.5)/1500,l=a.lng()+(Math.random()-.5)/1500;i=new google.maps.LatLng(o,l)}}var c=new google.maps.Marker({position:i,map:h,icon:r,draggable:!1,animation:google.maps.Animation.DROP}),p=t.data?t.data.post_title:t.title,d="";""!=t.image_url&&void 0!==t.image_url||(d='style="display: none;"');var u,_=document.createElement("div");_.className="marker-content clearfix",_.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+d+'><a href="'+t.url+'"><img src="'+t.image_url+'" alt="'+p+'" style="width: 100px;"></a></div><div class="item-body"><a href="'+t.url+'" class="title-marker">'+p+'</a><div class="price-marker">'+t.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+t.address+"</div></div></div>",google.maps.event.addListener(c,"click",(u=c,function(){var e=100/Math.pow(2,h.getZoom())||0,t=h.getProjection(),a=u.getPosition(),r=t.fromLatLngToPoint(a),i=new google.maps.Point(r.x,r.y-e),n=t.fromPointToLatLng(i);h.setCenter(n),setTimeout(function(){I.setContent(_),I.open(h,u)},300)})),B.push(c)})}O.ajax({dataType:"json",url:z,data:{action:"ere_property_search_ajax",title:i,address:h,country:e,state:a,city:t,neighborhood:r,type:s,status:n,bedrooms:o,bathrooms:l,min_price:p,max_price:d,min_area:u,max_area:_,label:g,garage:m,min_land_area:v,max_land_area:y,property_identity:b,features:f,search_type:c,ere_security_search_map:E},beforeSend:function(){P.parents("div.ere-search-properties-map").find("#ere-map-loading").fadeIn()},success:function(e){if("map_and_content"==c){var t=O(".owl-carousel",".list-property-result-ajax"),a=O(".list-property-result-ajax");if(t.empty(),!1===e.success)a.find(".title-result h2 .number-result").hide(),a.find(".title-result h2 .text-no-result").show(),a.find(".title-result h2 .text-result").hide();else{var r=O(".property-item",e.property_html);t.css("opacity",0),t.trigger("destroy.owl.carousel"),t.html(r),t.css("opacity",1),t.imagesLoaded(function(){ERE.set_item_effect(r,"hide"),ERE_Carousel.owlCarousel(),r=O(".property-item",t),ERE.set_item_effect(r,"show")}),"0"!=r.length&&(a.find(".title-result h2 .number-result").html(r.length),a.find(".title-result h2 .number-result").show(),a.find(".title-result h2 .text-no-result").hide(),a.find(".title-result h2 .text-result").show())}ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}if(T=new google.maps.Map(document.getElementById(w),L),google.maps.event.trigger(T,"resize"),!0===e.success&&e.properties)var i=e.properties.length;if(1==i)var n=google.maps.event.addListener(T,"bounds_changed",function(e){this.setZoom(parseInt(R)),google.maps.event.removeListener(n)});if(""!==S){var s=JSON.parse(S);T.setOptions({styles:s})}var o=new google.maps.LatLng("","");if(T.setCenter(o),T.setZoom(parseInt(R)),google.maps.event.addListener(T,"tilesloaded",function(){O("#ere-map-loading").fadeOut()}),!0===e.success){for(var l=0;l<B.length;l++)B[l].setMap(null);B=[],k(e.properties,T),T.fitBounds(B.reduce(function(e,t){return e.extend(t.getPosition())},new google.maps.LatLngBounds)),google.maps.event.trigger(T,"resize"),"1"==C&&new MarkerClusterer(T,B,{gridSize:60,maxZoom:18,styles:[{url:M,width:48,height:48,textColor:"#fff"}]}),q||A()}else P.empty().html('<div class="map-notfound">'+j+"</div>");P.closest("div.ere-search-properties-map").find("#ere-map-loading").fadeOut("slow")},error:function(){P.closest("div.ere-search-properties-map").find("#ere-map-loading").fadeOut("slow")}})}};var A=function(){return O(".property-item",H).each(function(e){O(this).on("mouseenter",function(){T&&google.maps.event.trigger(B[e],"click")}),O(this).on("mouseleave",function(){I.open(null,null)})}),!1};O(document).ready(function(){ERE_Property_Map_Search.init()}),O(window).resize(function(){ERE_Property_Map_Search.full_screen()}),O(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()})}(jQuery);