var ERE_Property_Map_Search=ERE_Property_Map_Search||{};!function(I){"use strict";var H,B,q=ere_search_map_vars.ajax_url,a=ere_search_map_vars.price_is_slider,D=ere_search_map_vars.item_amount,A=ere_search_map_vars.marker_image_size,N=".ere-search-map-properties",Z=[],G=!1;/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(G=!0),ERE_Property_Map_Search={init:function(){"1"==ere_search_map_vars.enable_filter_location&&(I(".ere-property-country-ajax",N).select2(),I(".ere-property-state-ajax",N).select2(),I(".ere-property-city-ajax",N).select2(),I(".ere-property-neighborhood-ajax",N).select2()),this.full_screen(),this.get_states_by_country(),I(".ere-property-country-ajax",N).on("change",function(){ERE_Property_Map_Search.get_states_by_country()}),this.get_cities_by_state(),I(".ere-property-state-ajax",N).on("change",function(){ERE_Property_Map_Search.get_cities_by_state()}),this.get_neighborhoods_by_city(),I(".ere-property-city-ajax",N).on("change",function(){ERE_Property_Map_Search.get_neighborhoods_by_city()}),I(".btn-status-filter",N).on("click",function(e){e.preventDefault();var a=I(this).data("value");I(this).parent().find("input").val(a),I(this).parent().find("button").removeClass("active"),I(this).addClass("active"),ERE_Property_Map_Search.change_price_on_status_change(a)}),I('select[name="status"]',N).on("change",function(e){e.preventDefault();var a=I(this).val();ERE_Property_Map_Search.change_price_on_status_change(a)}),this.execute_url_search(),I(".ere-sliderbar-filter.ere-sliderbar-price",N).on("register.again",function(){I(".ere-sliderbar-filter.ere-sliderbar-price",N).each(function(){var e=I(this);ERE_Property_Map_Search.set_slider_filter(e)})}),this.register_slider_filter(),this.set_slider_value(),this.property_map_paging(),this.search_map("map_only"),I(".other-features-wrap .btn-other-features",N).on("click",function(e){e.preventDefault(),I(".other-features-list",N).slideToggle(),I(this).toggleClass("show"),1==I(this).hasClass("show")?(I('input[name="features-search"]',N).attr("value","1"),I(this).find("i").removeClass("fa-chevron-down"),I(this).find("i").addClass("fa-chevron-up")):(I('input[name="features-search"]',N).attr("value","0"),I(this).find("i").removeClass("fa-chevron-up"),I(this).find("i").addClass("fa-chevron-down")),ERE_Property_Map_Search.search_map("map_and_content")}),I(".ere-sliderbar-filter.ere-sliderbar-price",N).on("register.again",function(){I(".ere-sliderbar-filter.ere-sliderbar-price",N).each(function(){var e=I(this);ERE_Property_Map_Search.set_slider_filter(e)})}),I(".ere-search-status-tab .btn-status-filter",N).on("click",function(){I(this).parent().find("input").val(I(this).data("value")),I(this).parent().find("button").removeClass("active"),I(this).addClass("active")}),I('select[name="type"], select[name="bedrooms"],select[name="bathrooms"] , select[name="garage"], select[name="label"],input[name="address"],input[name="title"],input[name="property_identity"], select[name="min-price"], select[name="max-price"],select[name="min-area"], select[name="max-area"],select[name="min-land-area"], select[name="min-land-area"], select[name="city"], select[name="country"], select[name="state"], select[name="neighborhood"]',N).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")}),I('input[name="other_features"]',N).on("change",function(){ERE_Property_Map_Search.search_map("map_and_content")})},get_states_by_country:function(){var e=I(".ere-property-country-ajax",N);if(e.length){var a=e.val();I.ajax({type:"POST",url:q,data:{action:"ere_get_states_by_country_ajax",country:a,type:1,is_slug:"1"},success:function(e){I(".ere-property-state-ajax",N).html(e);var a=I(".ere-property-state-ajax",N).attr("data-selected");void 0!==a&&I(".ere-property-state-ajax",N).val(a)}})}},get_cities_by_state:function(){var e=I(".ere-property-state-ajax",N);if(e.length){var a=e.val();I.ajax({type:"POST",url:q,data:{action:"ere_get_cities_by_state_ajax",state:a,type:1,is_slug:"1"},success:function(e){I(".ere-property-city-ajax",N).html(e);var a=I(".ere-property-city-ajax",N).attr("data-selected");void 0!==a&&I(".ere-property-city-ajax",N).val(a)}})}},get_neighborhoods_by_city:function(){var e=I(".ere-property-city-ajax",N);if(e.length){var a=e.val();I.ajax({type:"POST",url:q,data:{action:"ere_get_neighborhoods_by_city_ajax",city:a,type:1,is_slug:"1"},success:function(e){I(".ere-property-neighborhood-ajax",N).html(e);var a=I(".ere-property-neighborhood-ajax",N).attr("data-selected");void 0!==a&&I(".ere-property-neighborhood-ajax",N).val(a)}})}},execute_url_search:function(){I(".ere-advanced-search-btn",N).on("click",function(e){e.preventDefault();var a=I(this).closest(".search-properties-form"),t=a.data("href"),o=[],r="?";-1!==t.indexOf("?")&&(r="&"),I(".search-field",a).each(function(){var e=I(this),a=e.attr("name"),t=e.val();t!=e.data("default-value")&&(o[a]=t)}),I(".ere-sliderbar-filter",a).each(function(){var e=I(this),a=e.find(".min-input-request").attr("name"),t=e.find(".max-input-request").attr("name"),r=e.find(".min-input-request").val(),i=e.find(".max-input-request").val(),n=e.data("min-default"),s=e.data("max-default");r==n&&i==s||(o[a]=r,o[t]=i)});var i="";if(I('[name="other_features"]',a).each(function(){var e=I(this),a=e.attr("value");e.is(":checked")&&(i+=a+";")}),""!==i&&(i=i.substring("0",i.length-1),o.other_features=i),o!==[])for(var n in o)o.hasOwnProperty(n)&&(r+=n+"="+o[n]+"&");r=r.substring("0",r.length-1),window.location.href=t+r})},set_slider_filter:function(e){var t,r,i=e,a=parseInt(i.attr("data-min-default")),n=parseInt(i.attr("data-max-default")),s=i.attr("data-min"),o=i.attr("data-max");i.find(".sidebar-filter").slider({min:a,max:n,range:!0,values:[s,o],slide:function(e,a){t=a.values[0],r=a.values[1],i.attr("data-min",t),i.attr("data-max",r),i.find("input.min-input-request").attr("value",t),i.find("input.max-input-request").attr("value",r),i.find("span").hasClass("not-format")?(i.find("span.min-value").html(t),i.find("span.max-value").html(r)):(i.find("span.min-value:not(.not-format)").html(ERE.number_format(t)),i.find("span.max-value:not(.not-format)").html(ERE.number_format(r)))},stop:function(e,a){ERE_Property_Map_Search.search_map("map_and_content")}})},register_slider_filter:function(){I(".ere-sliderbar-filter",N).each(function(){var e=I(this);ERE_Property_Map_Search.set_slider_filter(e)})},set_slider_value:function(){I(".ere-sliderbar-filter",N).each(function(){var e=I(this),a=e.attr("data-min-default"),t=e.attr("data-max-default"),r=e.attr("data-min"),i=e.attr("data-max"),n=(r-a)/(t-a)*100+"%",s=(i-r)/(t-a)*100+"%",o=(i-a)/(t-a)*100+"%";e.find(".ui-slider-range.ui-corner-all.ui-widget-header").css({left:n,width:s}),e.find(".ui-slider-handle.ui-corner-all.ui-state-default").css("left",n),e.find(".ui-slider-handle.ui-corner-all.ui-state-default:last-child").css("left",o)})},change_price_on_status_change:function(e){I.ajax({type:"POST",url:q,dataType:"json",data:{action:"ere_ajax_change_price_on_status_change",status:e,price_is_slider:a},success:function(e){e.slide_html?(I(".ere-sliderbar-price-wrap",N).html(e.slide_html),ERE_Property_Map_Search.register_slider_filter(),ERE_Property_Map_Search.set_slider_value()):(e.min_price_html&&I('select[name="min-price"]',N).html(e.min_price_html),e.max_price_html&&I('select[name="max-price"]',N).html(e.max_price_html)),ERE_Property_Map_Search.search_map("map_and_content")}})},full_screen:function(){if(0<I(".ere-search-map-properties").length){var e=I(window).outerHeight(),a=I("#wpadminbar").outerHeight();null==a&&(a=0);var t=e-a-I("header").outerHeight()-I("footer").outerHeight()-I(".wpadminbar").outerHeight();I(".ere-search-map-properties .ere-map-search").css("height",t),I(".ere-search-map-properties .ere-map-search .ere-map-result").css("height",t),I(".col-scroll-vertical").css({height:t,"overflow-y":"scroll","overflow-x":"hidden"});var r=I(".property-vertical-map-listing",".list-property-result-ajax"),i=I(".property-item",r);r.css("opacity",1),r.imagesLoaded(function(){ERE.set_item_effect(i,"hide"),i=I(".property-item",r),ERE.set_item_effect(i,"show")})}},property_map_paging:function(){I(".paging-navigation",".property-search-map-paging-wrap").each(function(){I("a",I(this)).off("click").on("click",function(e){e.preventDefault();var a=I(this);ERE_Property_Map_Search.search_map("map_and_content",a)})})},property_map_paging_control:function(){I(".paging-navigation",".property-search-map-paging-wrap").each(function(){var e=I(this);0===e.find("a.next").length?e.addClass("next-disable"):e.removeClass("next-disable")})},search_map:function(d,e){var a,t,r,i,n,s,o,l,c,p,_,m,h,u,f,g,v,y,b,x,E=I(N),w=E.find(".ere-map-result").attr("id");n=E.find('input[name="title"]').val(),u=E.find('input[name="address"]').val(),t=E.find('select[name="city"]').val(),o=E.find('select[name="type"]').val(),null==(s=E.find('select[name="status"]').val())&&(s=E.find('input[name="status"]').val()),l=E.find('select[name="bedrooms"]').val(),c=E.find('select[name="bathrooms"]').val(),_=I(".ere-sliderbar-price",E).length?(p=E.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-min"),E.find(".ere-sliderbar-filter.ere-sliderbar-price").attr("data-max")):(p=E.find('select[name="min-price"]').val(),E.find('select[name="max-price"]').val()),h=I(".ere-sliderbar-area",E).length?(m=E.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-min"),E.find(".ere-sliderbar-filter.ere-sliderbar-area").attr("data-max")):(m=E.find('select[name="min-area"]').val(),E.find('select[name="max-area"]').val()),b=I(".ere-sliderbar-land-area",E).length?(y=E.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-min"),E.find(".ere-sliderbar-filter.ere-sliderbar-land-area").attr("data-max")):(y=E.find('select[name="min-land-area"]').val(),E.find('select[name="max-land-area"]').val()),r=E.find('select[name="state"]').val(),a=E.find('select[name="country"]').val(),i=E.find('select[name="neighborhood"]').val(),v=E.find('select[name="label"]').val(),f=E.find('select[name="garage"]').val(),x=E.find('input[name="property_identity"]').val(),"1"==E.find('input[name="features-search"]').val()&&(g="",E.find(".other-features-list input[type=checkbox]:checked").each(function(){g+=I(this).val()+";"}),""!=g&&(g=g.substring(0,g.length-1)));var P=I("#ere_security_search_map").val(),R=I("#"+w),j=ere_search_map_vars.googlemap_default_zoom,M=ere_search_map_vars.not_found,S=ere_search_map_vars.clusterIcon,C=ere_search_map_vars.google_map_style,k=ere_search_map_vars.pin_cluster_enable,T={zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER},scroll:{x:I(window).scrollLeft(),y:I(window).scrollTop()},zoom:parseInt(j),mapTypeId:google.maps.MapTypeId.ROADMAP,fullscreenControl:!0,gestureHandling:"cooperative",fullscreenControlOptions:{position:google.maps.ControlPosition.RIGHT_CENTER}};B=new InfoBox({disableAutoPan:!0,maxWidth:310,alignBottom:!0,pixelOffset:new google.maps.Size(-140,-55),zIndex:null,closeBoxMargin:"0 0 -16px -16px",infoBoxClearance:new google.maps.Size(1,1),isHidden:!1,pane:"floatPane",enableEventPropagation:!1});function L(e,h){I.each(e,function(e,a){for(var t=new google.maps.LatLng(a.lat,a.lng),r={url:a.marker_icon,size:new google.maps.Size(44,60),scaledSize:new google.maps.Size(44,60),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(7,27)},i=t,n=0;n<Z.length;n++){var s=Z[n].getPosition();if(t.equals(s)){var o=t.lat()+(Math.random()-.5)/1500,l=t.lng()+(Math.random()-.5)/1500;i=new google.maps.LatLng(o,l)}}var c=new google.maps.Marker({position:i,map:h,icon:r,draggable:!1,animation:google.maps.Animation.DROP}),p=a.data?a.data.post_title:a.title,d="";""!=a.image_url&&void 0!==a.image_url||(d='style="display: none;"');var _,m=document.createElement("div");m.className="marker-content clearfix",m.innerHTML='<div class="marker-content-inner clearfix"><div class = "item-thumb" '+d+'><a href="'+a.url+'"><img src="'+a.image_url+'" alt="'+p+'"></a></div><div class="item-body"><a href="'+a.url+'" class="title-marker">'+p+'</a><div class="price-marker">'+a.price+'</div><div class="address-marker"><i class="fa fa-map-marker"></i>'+a.address+"</div></div></div>",google.maps.event.addListener(c,"click",(_=c,function(){var e=100/Math.pow(2,h.getZoom())||0,a=h.getProjection(),t=_.getPosition(),r=a.fromLatLngToPoint(t),i=new google.maps.Point(r.x,r.y-e),n=a.fromPointToLatLng(i);h.setCenter(n),setTimeout(function(){B.setContent(m),B.open(h,_)},300)})),Z.push(c)})}var O=1;if(null!=e){var z=e.attr("href");O=ERE.get_page_number_from_href(z)}I.ajax({dataType:"json",url:q,data:{action:"ere_property_search_map_ajax",title:n,address:u,country:a,state:r,city:t,neighborhood:i,type:o,status:s,bedrooms:l,bathrooms:c,min_price:p,max_price:_,min_area:m,max_area:h,label:v,garage:f,min_land_area:y,max_land_area:b,property_identity:x,features:g,search_type:d,paged:O,item_amount:D,marker_image_size:A,ere_security_search_map:P},beforeSend:function(){R.parents("div.ere-search-map-properties").find("#ere-map-loading").fadeIn()},success:function(e){if("map_and_content"==d){var a=I(".property-vertical-map-listing"),t=I(".list-property-result-ajax");if(!1===e.success)t.find(".title-result h2 .number-result").hide(),t.find(".title-result h2 .text-no-result").show(),t.find(".title-result h2 .text-result").hide(),t.find(".property-vertical-map-listing").hide(),t.find(".property-search-map-paging-wrap").hide();else{var r=I(".property-item",e.property_html),i=I(".property-search-map-paging-wrap",e.property_html);a.css("opacity",0),a.html(r),ERE.set_item_effect(r,"hide");var n=a.offset().top-30;I("html,body").animate({scrollTop:+n+"px"},500),a.css("opacity",1),a.imagesLoaded(function(){r=I(".property-item",a),ERE.set_item_effect(r,"show"),a.closest("div.list-property-result-ajax").find(".property-search-map-paging-wrap").html(i.html()),ERE_Property_Map_Search.property_map_paging(),ERE_Property_Map_Search.property_map_paging_control(),ERE.favorite(),ERE.tooltip(),ERE_Compare.register_event_compare()}),"0"!=r.length&&(t.find(".title-result h2 .number-result").html(e.total_post),t.find(".title-result h2 .number-result").show(),t.find(".title-result h2 .text-no-result").hide(),t.find(".title-result h2 .text-result").show(),t.find(".property-vertical-map-listing").show(),t.find(".property-search-map-paging-wrap").show())}}if(H=new google.maps.Map(document.getElementById(w),T),google.maps.event.trigger(H,"resize"),!0===e.success&&e.properties)var s=e.properties.length;if(1==s)var o=google.maps.event.addListener(H,"bounds_changed",function(e){this.setZoom(parseInt(j)),google.maps.event.removeListener(o)});if(""!==C){var l=JSON.parse(C);H.setOptions({styles:l})}var c=new google.maps.LatLng("","");if(H.setCenter(c),H.setZoom(parseInt(j)),google.maps.event.addListener(H,"tilesloaded",function(){I("#ere-map-loading").fadeOut()}),!0===e.success){for(var p=0;p<Z.length;p++)Z[p].setMap(null);Z=[],L(e.properties,H),H.fitBounds(Z.reduce(function(e,a){return e.extend(a.getPosition())},new google.maps.LatLngBounds)),google.maps.event.trigger(H,"resize"),"1"==k&&new MarkerClusterer(H,Z,{gridSize:60,maxZoom:18,styles:[{url:S,width:48,height:48,textColor:"#fff"}]}),G||J()}else R.empty().html('<div class="map-notfound">'+M+"</div>");R.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow")},error:function(){R.closest("div.ere-search-map-properties").find("#ere-map-loading").fadeOut("slow"),0}})}};var J=function(){return I(".property-item",N).each(function(e){I(this).on("mouseenter",function(){H&&google.maps.event.trigger(Z[e],"click")}),I(this).on("mouseleave",function(){B.open(null,null)})}),!1};I(document).ready(function(){ERE_Property_Map_Search.init()}),I(window).resize(function(){ERE_Property_Map_Search.full_screen()}),I(window).on("orientationchange",function(){ERE_Property_Map_Search.full_screen()}),I("body").keydown(function(e){return 35==e.which||34==e.which?(I(".col-scroll-vertical").animate({scrollTop:I(".col-scroll-vertical-inner").height()},"slow"),!1):36==e.which||33==e.which?(I(".col-scroll-vertical").animate({scrollTop:0},"slow"),!1):void 0})}(jQuery);